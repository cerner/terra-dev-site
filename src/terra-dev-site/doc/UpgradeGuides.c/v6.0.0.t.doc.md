# v6.0.0 Upgrade Guide

This document will provide information on upgrading from Terra Dev Site `5.x.x` to `6.0.0`.

## Browser Router

Previously terra-dev-site used a hash router `/#/` to display its pages. This interferes with anchor tags which also use the hash to denote where to go on the page. To resolve this terra-dev-site has switched to a browser router. Current links using the hash router will still resolve, slash routes with the hash will be redirected to the equivalent non hash route.

To support hash routing with path based routing for gh-pages style deployments, you must supply an env variable, `TERRA_DEV_SITE_PUBLIC_PATH`, describing the path for assets to be served from.

For example, for a page hosted on github pages with a url of: <http://cerner.github.com/terra-dev-site.> The environment variable should be set as follows.

```bash
TERRA_DEV_SITE_PUBLIC_PATH='/terra-dev-site/'
```

Without the environment variable set assets will assume they are served from `/` when they should be served from `/terra-dev-site/`

## site.config

A few sections have been removed from site.config.

* Theme import - The need for this option has been removed with the aggregate-themes project.

* Extension config - The new navigation has a tighter definition of extensions and the github link no longer makes sense as an extension. Extensions are still customizable but the api has changed.

* Logo config removed. It's now best practice to not have an app logo.

## navigation.config

* Hide - The option to hide a navigation tab has been removed. This option was always a little weird. We wanted to hide the test tab for terra-ui and have access to it for sites with tests. It has caused discoverability issues and it's best if we just show the tab if available.

## Dynamic Imports

The code generated by terra dev site has always required transpilation, but with the addition of code splitting dynamic imports are required. No changes are needed if you are using babel 7.5 and babel-preset-env

## WDIO config removed

The wdio config was paired down to almost nothing so we decided to fully remove it. All it contained was setting the `webpackConfig` field to the terra-dev-site webpack config. To correct this either:

### Create a root level webpack config extending terra-dev-site's config and use the terra-toolkit wdio config

#### package.json

```json
{
  "scripts": {
    "wdio": "wdio node_modules/terra-toolkit/config/wdio/wdio.conf.js"
  }
}
```

#### webpack.config

```javascript
const terraDevSiteWebpackConfig = require('terra-dev-site/config/webpack/webpack.config');

module.exports = terraDevSiteWebpackConfig;
```

### Create a root level wdio config pulling setting the `webpackConfig` variable to terra-dev-site's webpack config.

#### wdio.config

```javascript
const wdioConf = require('terra-toolkit/config/wdio/wdio.conf');
const webpackConfig = require('terra-dev-site/config/webpack/webpack.config');

const config = {
  ...wdioConf.config,

  webpackConfig,
};

exports.config = config;
```


## Test Updates

With dynamic imports there can now be a slight delay before your test pages load. Changes have been made terra toolkit 5.2.0 to mitigate these issues but if you have a slow page and are seeing timeouts you may have to add a wait for exist check on the 'data-terra-dev-site-content' selector.

```javascript
browser.waitForExist('[data-terra-dev-site-content]');
```

Previously with the hash router, a duplicate call to browser.url would result in a no-op. Now with the hash router the duplicate call will behave as a refresh.

```javascript
browser.url('/#/raw/thing/route'); // Loads the page at the url
browser.url('/#/raw/thing/route'); // Previously was a no-op, now reloads the page at the url.
```

To mitigate this issue re-factor the test to remove the duplicate call to browser.url.

You may also see some issues with cursor positioning. If items with a hover state no longer appear hovered, try moving the cursor to the item.
